#!/bin/sh
/sbin/setup-alpine; 
/usr/sbin/adduser admin; 
/bin/chmod -R 0700 /home/admin; 
/bin/mkdir /etc/home; 
/bin/chmod 600 /etc/home;
/bin/cat "/media/usb/files/5.6.2 sysctl" >> /etc/sysctl.conf;
/bin/chmod 0700 /etc/sysctl.conf;
/bin/mkdir /etc/files;
/bin/cp /media/usb/files/noroot.sh /etc/files;
/bin/cp /media/usb/files/startscript.sh /etc/files;
/bin/chown -R root:root /etc/files/*;
/bin/chmod -R 0500 /etc/files/*;
/bin/echo -e "tmpfs /home tmpfs nosuid,nodev,noexec,mode=0755 0 0\ntmpfs /tmp tmpfs nosuid,nodev,noexec 0 0\ntmpfs /var/tmp tmpfs nosuid,nodev,noexec 0 0\ntmpfs /media/usb tmpfs nosuid,nodev,noexec,user 0 0" >> /etc/fstab;
/bin/cp /media/usb/files/boot.start /etc/local.d;
/bin/chmod 0500 /etc/local.d/boot.start;
/sbin/rc-update add local default;
/sbin/apk verify /media/usb/apks/*.apk;
/sbin/apk add /media/usb/apks/*.apk;
/bin/echo -e "Defaults secure_path=\"/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"\nDefaults passwd_tries=1\nDefaults use_pty\nDefaults requiretty\nDefaults env_reset, timestamp_timeout=0\nadmin ALL=(ALL) ALL" | EDITOR="/usr/bin/tee -a" /usr/sbin/visudo;
/bin/sed -i "1s/:::::/::::1:/g" /etc/shadow; 
/bin/sed -i "s/^/#/" /etc/securetty; 
/usr/bin/passwd -l root;
/usr/sbin/deluser sync;
/usr/sbin/deluser shutdown;
/usr/sbin/deluser halt;
/bin/chmod 0400 /etc/shadow;
/bin/chmod 0700 -R /etc/init.d/*;
/bin/chmod 0700 /etc/inittab;
/bin/cp /media/usb/historyserver/.ash_history /home/admin;
/bin/chown admin:admin /home/admin/.ash_history;
/bin/chmod 0600 /home/admin/.ash_history
/bin/cp -rp /home/* /etc/home/;
/sbin/lbu commit;